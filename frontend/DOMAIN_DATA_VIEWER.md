# 前端展示领域模型数据 - 完成总结

## 概述

已完成前端页面的修改,现在可以展示后端返回的真实领域模型数据(`domain_data`)。

## 改动内容

### 1. 创建 `DomainDataViewer.vue` 组件

**文件**: `frontend/src/components/projects/DomainDataViewer.vue`

**功能**: 根据阶段类型展示不同的领域模型数据

**支持的阶段**:

#### ✅ 文案改写 (rewrite)
- 显示统计卡片: 原始文本长度、改写后文本长度、使用的模型
- 并排展示原始文本和改写后文本
- 显示模型提供商信息

#### ✅ 分镜生成 (storyboard)
- 显示分镜总数和使用的模型
- 卡片列表展示每个分镜:
  - 分镜序号和时长
  - 场景描述
  - 旁白文案
  - 文生图提示词

#### ✅ 文生图 (image_generation)
- 显示分镜总数和总图片数
- 按分镜组织展示图片:
  - 图片网格展示(响应式布局)
  - 图片尺寸和模型信息(hover显示)
  - 图片状态标签
  - 点击图片可预览大图

#### ✅ 运镜生成 (camera_movement)
- 显示分镜总数和已设置运镜数量
- 按分镜展示运镜数据:
  - 运镜类型标签
  - 使用的模型
  - 运镜参数(JSON格式)

### 2. 修改 `StageContent.vue` 组件

**文件**: `frontend/src/components/projects/StageContent.vue`

**改动**:
1. 导入 `DomainDataViewer` 组件
2. 在组件注册中添加 `DomainDataViewer`
3. 在模板中添加领域数据展示区域:
   ```vue
   <!-- 领域数据展示区域 -->
   <div v-if="stage && stage.domain_data" class="mt-6">
     <div class="divider">领域数据</div>
     <DomainDataViewer
       :stage-type="stageType"
       :domain-data="stage.domain_data"
     />
   </div>
   ```

## 页面布局

现在每个阶段的页面布局如下:

```
┌─────────────────────────────────────┐
│ 阶段状态信息 (Alert)                 │
├─────────────────────────────────────┤
│ 操作按钮 (重置/保存/AI生成)          │
├─────────────────────────────────────┤
│ 输入/输出编辑区域 (Textarea)         │
│ ┌─────────────┬─────────────┐       │
│ │ 输入数据    │ 输出数据    │       │
│ └─────────────┴─────────────┘       │
├─────────────────────────────────────┤
│ 领域数据 (DomainDataViewer) ⭐ 新增  │
│ - 结构化展示真实数据库数据           │
│ - 包含模型提供商信息                 │
│ - 图片/视频预览                      │
├─────────────────────────────────────┤
│ 分镜可视化 (StoryboardViewer)       │
│ - 保留原有功能                       │
└─────────────────────────────────────┘
```

## 展示效果

### 文案改写阶段

```
┌─────────────────────────────────────┐
│ 统计卡片                             │
│ ┌──────┬──────┬──────┐              │
│ │原始  │改写后│使用的│              │
│ │1234字│1456字│模型  │              │
│ └──────┴──────┴──────┘              │
├─────────────────────────────────────┤
│ 文本对比                             │
│ ┌─────────────┬─────────────┐       │
│ │ 原始文本    │ 改写后文本  │       │
│ │ ...         │ ...         │       │
│ └─────────────┴─────────────┘       │
└─────────────────────────────────────┘
```

### 分镜生成阶段

```
┌─────────────────────────────────────┐
│ 共 5 个分镜 | 使用模型: GPT-4        │
├─────────────────────────────────────┤
│ ┌─ 分镜 1 ──────────── 3秒 ─┐      │
│ │ 场景描述: 特写镜头          │      │
│ │ 旁白文案: ...               │      │
│ │ 文生图提示词: ...           ��      │
│ └─────────────────────────────┘      │
│ ┌─ 分镜 2 ──────────── 3秒 ─┐      │
│ │ ...                         │      │
│ └─────────────────────────────┘      │
└─────────────────────────────────────┘
```

### 文生图阶段

```
┌─────────────────────────────────────┐
│ 共 5 个分镜 | 总图片数: 10           │
├─────────────────────────────────────┤
│ ┌─ 分镜 1 ─────────────────┐        │
│ │ ┌───┬───┬───┬───┐        │        │
│ │ │img│img│img│img│ (网格) │        │
│ │ └───┴───┴───┴───┘        │        │
│ └───────────────────────────┘        │
│ ┌─ 分镜 2 ─────────────────┐        │
│ │ ┌───┬───┐                │        │
│ │ │img│img│                │        │
│ │ └───┴───┘                │        │
│ └───────────────────────────┘        │
└─────────────────────────────────────┘
```

### 运镜生成阶段

```
┌─────────────────────────────────────┐
│ 共 5 个分镜 | 已设置运镜: 3 个       │
├─────────────────────────────────────┤
│ ┌─ 分镜 1 ─────────────────┐        │
│ │ [推进] 模型: GPT-4        │        │
│ │ 运镜参数:                 │        │
│ │ {                         │        │
│ │   "speed": "slow",        │        │
│ │   "duration": 3.0         │        │
│ │ }                         │        │
│ └───────────────────────────┘        │
└─────────────────────────────────────┘
```

## 特性

### 1. 响应式设计
- 使用 Tailwind CSS 的响应式类
- 移动端友好的布局
- 图片网格自适应

### 2. 交互功能
- ✅ 图片点击预览(模态框)
- ✅ 图片 hover 显示详细信息
- ✅ 状态标签(pending/processing/completed/failed)
- ✅ 模型提供商信息展示

### 3. 数据展示
- ✅ 统计卡片(文案改写)
- ✅ 卡片列表(分镜/运镜)
- ✅ 图片网格(文生图)
- ✅ JSON 格式化显示(运镜参数)

### 4. 空状态处理
- 如果 `domain_data` 为 `null`,显示提示信息
- 如果某个分镜没有数据,显示"暂无数据"

## 数据流

```
后端 API
  ↓
ProjectStage.domain_data
  ↓
StageContent.vue (接收 stage prop)
  ↓
DomainDataViewer.vue (接收 domain_data prop)
  ↓
根据 stageType 渲染不同的展示组件
```

## 向后兼容性

✅ **完全兼容**

- 保留了原有的 `input_data` 和 `output_data` 展示
- 保留了原有的 `StoryboardViewer` 组件
- 新增的 `DomainDataViewer` 只在 `domain_data` 存在时显示
- 不影响现有功能

## 使用示例

### 在项目详情页查看

1. 打开项目详情页: `/projects/{id}`
2. 切换到任意阶段 Tab (文案改写/分镜输出/文生图/运镜输出)
3. 如果该阶段已完成,会看到:
   - 输入/输出编辑区域(原有功能)
   - **领域数据区域**(新增,展示真实数据库数据)
   - 分镜可视化区域(原有功能)

### 数据更新

当阶段完成后:
1. WebSocket 推送更新
2. 前端刷新项目数据
3. `stage.domain_data` 自动更新
4. `DomainDataViewer` 自动重新渲染

## 相关文件

### 前端
- `frontend/src/components/projects/DomainDataViewer.vue` - 新增组件
- `frontend/src/components/projects/StageContent.vue` - 修改
- `frontend/src/views/projects/ProjectDetail.vue` - 无需修改(自动生效)

### 后端
- `backend/apps/projects/serializers.py` - ProjectStageSerializer
- `backend/apps/content/models.py` - 领域模型定义

## 样式说明

使用 daisyUI 组件:
- `stats` - 统计卡片
- `card` - 卡片容器
- `badge` - 标签
- `alert` - 提示信息
- `modal` - 模态框
- `divider` - 分隔线

## 后续优化建议

1. **图片懒加载**: 使用 `IntersectionObserver` 实现图片懒加载
2. **虚拟滚动**: 如果分镜数量很多,使用虚拟滚动优化性能
3. **图片下载**: 添加批量下载图片功能
4. **数据导出**: 添加导出为 JSON/CSV 功能
5. **搜索过滤**: 添加分镜搜索和过滤功能
6. **排序**: 支持按不同字段排序

## 测试建议

### 手动测试

1. **文案改写阶段**:
   - 执行 AI 生成
   - 检查统计卡片是否正确
   - 检查文本对比是否正确
   - 检查模型信息是否显示

2. **分镜生成阶段**:
   - 执行 AI 生成
   - 检查分镜列表是否正确
   - 检查每个分镜的字段是否完整
   - 检查排序是否正确

3. **文生图阶段**:
   - 执行 AI 生成
   - 检查图片是否正确显示
   - 点击图片检查预览功能
   - Hover 图片检查信息显示
   - 检查状态标签是否正确

4. **运镜生成阶段**:
   - 执行 AI 生成
   - 检查运镜类型是否正确
   - 检查运镜参数是否格式化显示
   - 检查模型信息是否显示

### 边界情况测试

1. **空数据**: 阶段未执行时,应显示提示信息
2. **部分数据**: 某些分镜有数据,某些没有
3. **大量数据**: 100+ 个分镜的性能测试
4. **错误数据**: 图片 URL 无效时的处理

## 总结

✅ **已完成**:
- 创建 `DomainDataViewer.vue` 组件
- 修改 `StageContent.vue` 集成新组件
- 支持 4 个阶段的数据展示(rewrite/storyboard/image_generation/camera_movement)
- 响应式设计和交互功能
- 向后兼容

🎯 **优势**:
- 数据展示更直观
- 包含完整的元数据信息
- 用户体验更好
- 易于维护和扩展

📝 **待实现**:
- video_generation 阶段的展示(后端也待实现)
- 图片懒加载和虚拟滚动
- 批量下载和导出功能
