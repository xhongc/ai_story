# 项目详情页画布功能

## 功能概述

项目详情页新增了"工作流画布"视图，以可视化的方式展示项目的完整工作流程。

## 功能特性

### 1. 画布交互
- ✅ **缩放控制**: 支持放大/缩小/重置视图
- ✅ **拖动画布**: 鼠标拖动浏览整个工作流
- ✅ **滚轮缩放**: 使用鼠标滚轮快速缩放

### 2. 节点展示
- ✅ **文案改写节点**: 显示改写后的文案摘要
- ✅ **分镜集群**: 卡片网格布局展示所有分镜
- ✅ **分镜卡片**: 每个分镜包含三个子流程
  - 文生图节点
  - 运镜节点
  - 图生视频节点

### 3. 状态可视化
- ✅ **节点状态**: 通过颜色区分不同状态
  - 灰色: 待处理 (pending)
  - 蓝色: 处理中 (processing)
  - 绿色: 已完成 (completed)
  - 红色: 失败 (failed)
- ✅ **连接线**: 显示节点间的数据流向
- ✅ **实时更新**: 通过WebSocket实时更新节点状态

### 4. 交互功能
- ✅ **节点点击**: 点击节点跳转到对应的详情Tab
- ✅ **分镜点击**: 点击分镜卡片查看详细信息

## 组件架构

```
frontend/src/components/canvas/
├── FlowCanvas.vue           # 画布容器（缩放、拖动、连接线）
├── BaseNode.vue             # 基础节点组件
├── RewriteNode.vue          # 文案改写节点
├── StoryboardCluster.vue    # 分镜集群容器
├── StoryboardCard.vue       # 分镜卡片（包含子流程）
└── ProjectCanvas.vue        # 项目画布主组件
```

## 使用方法

### 1. 访问画布
在项目详情页，点击"工作流画布"Tab即可查看。

### 2. 画布操作
- **放大**: 点击右上角的 + 按钮
- **缩小**: 点击右上角的 - 按钮
- **重置**: 点击右上角的重置按钮
- **拖动**: 在空白区域按住鼠标左键拖动
- **缩放**: 使用鼠标滚轮

### 3. 节点交互
- **查看详情**: 点击文案改写节点的"查看详情"按钮
- **切换Tab**: 点击任意节点会自动切换到对应的详情Tab
- **查看分镜**: 点击分镜卡片查看该分镜的详细信息

## 数据流

```
ProjectDetail.vue
  ├── 获取项目数据 (project)
  ├── 获取阶段数据 (stages)
  └── 从stages中提取分镜数据 (storyboards)
      └── ProjectCanvas.vue
          ├── FlowCanvas.vue (画布容器)
          ├── RewriteNode.vue (文案改写)
          └── StoryboardCluster.vue (分镜集群)
              └── StoryboardCard.vue × N (多个分镜卡片)
```

## 技术实现

### 1. 纯CSS实现
- 使用 CSS `transform` 实现缩放和平移
- 使用 SVG `path` 绘制贝塞尔曲线连接线
- 无第三方依赖，轻量级实现

### 2. 响应式布局
- 分镜卡片采用网格布局（每行2个）
- 自动计算节点位置
- 支持任意数量的分镜

### 3. 状态管理
- 通过 props 传递项目、阶段、分镜数据
- 通过 events 向上传递用户交互
- 与现有的 WebSocket 集成，实时更新

## 样式定制

所有组件使用 daisyUI + Tailwind CSS，支持主题切换：

```css
/* 节点状态颜色 */
.status-pending { border-color: hsl(var(--bc) / 0.2); }
.status-processing { border-color: hsl(var(--in)); }
.status-completed { border-color: hsl(var(--su)); }
.status-failed { border-color: hsl(var(--er)); }
```

## 后续优化建议

1. **性能优化**
   - 大量分镜时使用虚拟滚动
   - 节点懒加载

2. **功能增强**
   - 支持节点拖动重排
   - 添加缩略图导航
   - 支持全屏模式
   - 添加节点搜索/过滤

3. **数据增强**
   - 添加专门的分镜列表API
   - 包含更详细的图片、视频信息
   - 支持分镜预览

## 注意事项

1. **数据来源**: 当前分镜数据从 `storyboard` 阶段的 `output_data` 中提取
2. **默认Tab**: 项目详情页默认打开"工作流画布"Tab
3. **空状态**: 如果没有执行任何阶段，画布会显示空状态提示
