# 全局变量功能使用指南

## 功能概述

全局变量系统允许用户定义可在所有提示词模板中重复使用的变量，提高提示词管理的效率和一致性。

## 访问入口

在左侧导航栏中点击 **"全局变量"** 菜单项，即可进入全局变量管理页面。

路径：`/prompts/variables`

## 主要功能

### 1. 查看变量列表

变量列表以表格形式展示，包含以下信息：
- **变量键**：变量的唯一标识符（代码格式显示）
- **值**：变量的实际值
- **类型**：变量的数据类型（字符串/数字/布尔值/JSON对象）
- **作用域**：用户级或系统级
- **分组**：变量所属的分组
- **描述**：变量的用途说明
- **状态**：激活/停用
- **更新时间**：最后修改时间

### 2. 筛选和搜索

页面顶部提供多种筛选选项：
- **搜索框**：按变量键或描述搜索
- **作用域筛选**：全部/用户级/系统级
- **类型筛选**：全部/字符串/数字/布尔值/JSON对象
- **分组筛选**：按分组过滤变量

### 3. 创建变量

点击右上角的 **"+ 创建变量"** 按钮，填写以下信息：

#### 必填字段
- **变量键**：
  - 只能包含字母、数字、下划线
  - 必须以字母或下划线开头
  - 不能是 Python 保留字
  - 示例：`brand_name`, `max_length`, `_config`

- **变量值**：
  - 根据类型输入相应格式的值
  - 字符串：任意文本
  - 数字：整数或小数
  - 布尔值：true/false, 1/0, yes/no, on/off
  - JSON对象：有效的 JSON 字符串

- **变量类型**：
  - 字符串：文本内容
  - 数字：数值（自动转换为整数或浮点数）
  - 布尔值：真/假值
  - JSON对象：复杂的结构化数据

- **作用域**：
  - 用户级：仅自己可见和使用
  - 系统级：所有用户可见（需要管理员权限）

#### 可选字段
- **分组**：将变量归类到特定分组，便于管理
  - 可选择现有分组
  - 可创建新分组

- **描述**：说明变量的用途和使用场景

- **激活状态**：是否启用此变量

### 4. 编辑变量

点击变量行的 **编辑按钮**（铅笔图标），可修改变量的值、类型、分组、描述等信息。

**注意**：变量键在创建后不可修改。

### 5. 删除变量

点击变量行的 **删除按钮**（垃圾桶图标），确认后删除变量。

**权限限制**：
- 用户只能删除自己创建的用户级变量
- 系统级变量只能由管理员删除

## 在提示词模板中使用

### 基本语法

在提示词模板中使用 Jinja2 语法引用变量：

```jinja2
{{ variable_key }}
```

### 使用示例

#### 示例 1：品牌信息

创建变量：
```
key: brand_name
value: AI Story
type: string
group: 品牌信息
```

在模板中使用：
```jinja2
请为 {{ brand_name }} 品牌创作一个故事。
```

渲染结果：
```
请为 AI Story 品牌创作一个故事。
```

#### 示例 2：数值参数

创建变量：
```
key: max_story_length
value: 2000
type: number
group: 技术参数
```

在模板中使用：
```jinja2
请创作一个不超过 {{ max_story_length }} 字的故事。
```

#### 示例 3：条件判断

创建变量：
```
key: enable_emoji
value: true
type: boolean
group: 技术参数
```

在模板中使用：
```jinja2
{% if enable_emoji %}
可以适当使用表情符号增加趣味性。
{% endif %}
```

#### 示例 4：JSON 对象

创建变量：
```
key: image_config
value: {"ratio": "16:9", "quality": "high"}
type: json
group: 技术参数
```

在模板中使用：
```jinja2
图片配置：
- 比例：{{ image_config.ratio }}
- 质量：{{ image_config.quality }}
```

## 变量优先级

当变量名冲突时，按以下优先级使用：

1. **输入数据**（最高优先级）- 来自当前阶段的输入
2. **项目信息** - project.name, project.description 等
3. **全局变量**（最低优先级）- 用户定义的全局变量

## 最佳实践

### 1. 命名规范
- 使用有意义的名称：`brand_name` 而不是 `bn`
- 使用下划线分隔：`max_story_length` 而不是 `maxStoryLength`
- 保持名称简洁：不超过 30 个字符

### 2. 合理分组
- 按功能分组：品牌信息、技术参数、风格设置等
- 保持分组名称一致性
- 避免创建过多分组（建议 5-10 个）

### 3. 添加描述
- 清晰说明变量用途
- 记录取值范围或格式要求
- 说明使用场景和注意事项

### 4. 类型选择
- 优先使用字符串类型（最灵活）
- 需要数值计算时使用数字类型
- 开关配置使用布尔类型
- 复杂配置使用 JSON 类型

### 5. 作用域管理
- 个人使用的变量使用用户级作用域
- 全局通用的变量由管理员创建为系统级
- 避免创建过多系统级变量

## 常见问题

### Q: 变量键可以修改吗？
A: 不可以。变量键在创建后不可修改。如需更改，请删除旧变量并创建新变量。

### Q: 如何知道变量在哪些模板中被使用？
A: 目前系统不提供变量使用追踪功能。建议在变量描述中记录使用场景。

### Q: 可以导入/导出变量吗？
A: 目前不支持。可以使用批量创建 API 实现类似功能。

### Q: 系统级变量和用户级变量有什么区别？
A:
- 系统级变量：所有用户可见，只能由管理员创建和删除
- 用户级变量：仅创建者可见，用户可自由管理

### Q: JSON 类型的变量如何使用？
A: 使用点号访问 JSON 对象的属性，例如：`{{ config.key }}`

### Q: 变量值可以包含其他变量吗？
A: 不可以。变量值不支持嵌套引用。

## 技术支持

如遇问题，请联系系统管理员或查看完整的 API 文档。
